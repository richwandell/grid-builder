{"version":3,"sources":["../../src/server/Ssdp.es6"],"names":["dgram","require","fs","Logger","Utils","pjson","Server","builder","Ssdp","log","logfolder","builder_log_folder","filename","filesize","numfiles","b","server","location","getServerIp","builder_rest_port","addUSN","on","headers","start","process","stop"],"mappings":";;;;;;;;;;AAAA,IAAMA,QAAQC,QAAQ,OAAR,CAAd;AACA,IAAMC,KAAKD,QAAQ,IAAR,CAAX;AACA,IAAME,SAASF,QAAQ,UAAR,CAAf;AACA,IAAMG,QAAQH,QAAQ,YAAR,CAAd;AACA,IAAMI,QAAQJ,QAAQ,oBAAR,CAAd;AACA,IAAMK,SAASL,QAAQ,WAAR,EAAqBK,MAApC;AACA,IAAIC,UAAU,KAAd;;IAEMC,I;AAEF,oBAAa;AAAA;;AACT,aAAKC,GAAL,GAAW,IAAIN,MAAJ,CAAW;AAClBO,uBAAWL,MAAMM,kBADC;AAElBC,sBAAU,UAFQ;AAGlBC,sBAAU,OAHQ;AAIlBC,sBAAU;AAJQ,SAAX,CAAX;AAMH;;;;iCAEQC,C,EAAG;AACRR,sBAAUQ,CAAV;AACH;;;yCAEgB;AACb,gBAAIN,MAAM,KAAKA,GAAf;AACA,gBAAMO,SAAS,IAAIV,MAAJ,CAAW;AACtBW,0BAAU,YAAYb,MAAMc,WAAN,EAAZ,GAAkC,GAAlC,GAAsCb,MAAMc,iBAA5C,GAA8D;AADlD,aAAX,CAAf;;AAIAH,mBAAOI,MAAP,CAAc,iBAAd;AACAJ,mBAAOI,MAAP,CAAc,2CAAd;AACAJ,mBAAOI,MAAP,CAAc,iDAAd;AACAJ,mBAAOI,MAAP,CAAc,kDAAd;;AAEAJ,mBAAOK,EAAP,CAAU,iBAAV,EAA6B,UAAUC,OAAV,EAAmB;AAC5Cb,oBAAIA,GAAJ,CAAQa,OAAR;AACH,aAFD;;AAIAN,mBAAOK,EAAP,CAAU,eAAV,EAA2B,UAAUC,OAAV,EAAmB;AAC1Cb,oBAAIA,GAAJ,CAAQa,OAAR;AACH,aAFD;;AAIA;AACAN,mBAAOO,KAAP;AACAC,oBAAQH,EAAR,CAAW,MAAX,EAAmB,YAAY;AAC3BZ,oBAAIA,GAAJ,CAAQ,MAAR;AACAO,uBAAOS,IAAP;AACH,aAHD;AAIH;;;;;;kBAIUjB,I","file":"Ssdp.js","sourcesContent":["const dgram = require('dgram');\nconst fs = require(\"fs\");\nconst Logger = require('./Log.js');\nconst Utils = require('./Utils.js');\nconst pjson = require('../../package.json');\nconst Server = require('node-ssdp').Server;\nlet builder = false;\n\nclass Ssdp {\n\n    constructor(){\n        this.log = new Logger({\n            logfolder: pjson.builder_log_folder,\n            filename: \"ssdp.log\",\n            filesize: 5000000,\n            numfiles: 3\n        });\n    }\n\n    register(b) {\n        builder = b;\n    }\n\n    startBroadcast() {\n        let log = this.log;\n        const server = new Server({\n            location: 'http://' + Utils.getServerIp() + \":\"+pjson.builder_rest_port+\"/devicedescription.xml\"\n        });\n\n        server.addUSN('upnp:rootdevice');\n        server.addUSN('urn:schemas-upnp-org:device:MediaServer:1');\n        server.addUSN('urn:schemas-upnp-org:service:ContentDirectory:1');\n        server.addUSN('urn:schemas-upnp-org:service:ConnectionManager:1');\n\n        server.on('advertise-alive', function (headers) {\n            log.log(headers);\n        });\n\n        server.on('advertise-bye', function (headers) {\n            log.log(headers);\n        });\n\n        // start the server\n        server.start();\n        process.on('exit', function () {\n            log.log(\"exit\");\n            server.stop();\n        });\n    }\n}\n\n\nexport default Ssdp;\n"]}