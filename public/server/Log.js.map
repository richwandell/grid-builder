{"version":3,"sources":["Log.es6"],"names":["fs","require","Log","options","filename","filesize","logfolder","numfiles","debug","attrname","hasOwnProperty","fullpath","existingFiles","dir","files","readdirSync","forEach","file","indexOf","push","appendFile","watch","eventType","rotate","numFiles","length","stat","err","stats","size","console","log","x","existingFile","newName","rename","writeFileSync","readFileSync","rand","Math","random","unlink","pop","message","st","JSON","stringify","e","module","exports"],"mappings":"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","file":"Log.js","sourcesContent":["const fs = require('fs');\n\nclass Log {\n\n    constructor(options){\n        this.options = {\n            filename: \"log.log\",\n            filesize: 1000000,\n            logfolder: \"log\",\n            numfiles: 3,\n            debug: true\n        };\n        for (let attrname in options) {\n            if(this.options.hasOwnProperty(attrname)){\n                this.options[attrname] = options[attrname];\n            }\n        }\n        this.fullpath = this.options.logfolder + \"/\" + this.options.filename;\n        this.existingFiles = [];\n        const dir = this.options.logfolder;\n        const files = fs.readdirSync(dir);\n        const filename = this.options.filename;\n\n        files.forEach((file) => {\n            if(file.indexOf(filename) > -1){\n                this.existingFiles.push(file);\n            }\n        });\n\n        fs.appendFile(this.fullpath, \"[INFO] log file opened \\n\", () =>{\n            fs.watch(this.fullpath, (eventType, filename) =>{\n                this.rotate(eventType, filename);\n            });\n        });\n    }\n\n    rotate(eventType, filename) {\n        if(eventType == \"change\"){\n            const filesize = this.options.filesize;\n            const numFiles = this.existingFiles.length - 1;\n            fs.stat(this.fullpath, (err, stats) => {\n                if(stats.size >= filesize){\n                    console.log(\"should rotate\");\n                    for(let x = 0; x < this.existingFiles.length; x++){\n                        let existingFile = this.existingFiles[x];\n                        if(existingFile != this.options.filename){\n                            let newName = this.fullpath + \".\" + (x + 1);\n                            fs.rename(this.options.logfolder + \"/\" + existingFile, newName, function(){});\n                        }\n                    }\n                    fs.writeFileSync(this.fullpath + \".0\", fs.readFileSync(this.fullpath));\n                    this.existingFiles.push(this.fullpath + \".\" + numFiles);\n                    let rand = Math.random();\n                    fs.writeFileSync(this.fullpath, \"file rotated: [\" + rand + \"]\");\n                    if(numFiles >= this.options.numfiles){\n                        fs.unlink(this.fullpath + \".\" + (this.existingFiles.length - 1), () => {\n                            this.existingFiles.pop();\n                        });\n                    }\n                }\n            });\n        }\n    }\n\n    log(message){\n        let st;\n        try{\n            st = JSON.stringify(message);\n        }catch(e){\n            st = message;\n        }\n        fs.appendFile(this.fullpath, \"[INFO] \" + st + \"\\n\", function(){});\n    }\n\n    error(message){\n        let st;\n        try{\n            st = JSON.stringify(message);\n        }catch(e){\n            st = message;\n        }\n        fs.appendFile(this.fullpath, \"[ERROR] \" + st + \"\\n\", function(){});\n    }\n\n    debug(message){\n        if(!this.options.debug) return;\n        let st;\n        try{\n            st = JSON.stringify(message);\n        }catch(e){\n            st = message;\n        }\n        fs.appendFile(this.fullpath, \"[DEBUG] \" + st + \"\\n\", function(){});\n    }\n}\n\n\nmodule.exports = Log;"]}