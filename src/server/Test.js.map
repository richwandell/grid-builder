{"version":3,"sources":["Test.es6"],"names":["fs","require","pjson","Logger","Test","log","logfolder","builder_log_folder","filename","filesize","numfiles","database","createTables","db","getDatabase","rows","readFileSync","split","features","fp_id","forEach","row","row1","Math","abs","Number","data","keys","Object","done","key","all","query_get_features","replace","err","push","length","console","makeGuess","distances","knn","feature","coord","x","y","pow","diff","x_y","distance","sqrt","reduce","a","b","sort"],"mappings":"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","file":"Test.js","sourcesContent":["import Db from './Db';\nconst fs = require('fs');\nconst pjson = require('../package.json');\nconst Logger = require('./Log.js');\n\nclass Test {\n    constructor(){\n        let log = new Logger({\n            logfolder: pjson.builder_log_folder,\n            filename: \"rest.log\",\n            filesize: 5000000,\n            numfiles: 3\n        });\n        let database = new Db(log);\n        database.createTables();\n\n        let db = database.getDatabase();\n\n        let rows = fs.readFileSync(\"./1-28.csv\", \"utf8\").split(\"\\n\");\n\n        let features = {};\n\n        let fp_id = 0;\n\n        rows.forEach((row) => {\n            row = row.split(\",\");\n            if(typeof(row[1]) == \"undefined\") return;\n\n            rows.forEach((row1) => {\n                row1 = row1.split(\",\");\n                if(typeof(row1[1]) == \"undefined\") return;\n                fp_id = row[0];\n                features[row[1] + row1[1]] = Math.abs(Number(row[4]) - Number(row1[4]));\n            });\n        });\n\n        let data = [];\n        let keys = Object.keys(features);\n        let done = 0;\n\n        keys.forEach((key) => {\n            db.all(Db.query_get_features.replace(\":feature_value:\", features[key]), [key, fp_id], (err, rows) => {\n                data.push(rows);\n                done++;\n                if(done >= keys.length){\n                    console.log(data.length, keys.length);\n                    this.makeGuess(data);\n                }\n            });\n        });\n    }\n\n    makeGuess(data){\n        let distances = {};\n        let knn = [];\n\n        data.forEach((feature) => {\n            if(feature.length == 0) return;\n\n            feature.forEach((coord) => {\n                if(typeof(distances[coord.x + \"_\" + coord.y]) == \"undefined\"){\n                    distances[coord.x + \"_\" + coord.y] = [];\n                }\n\n                distances[coord.x + \"_\" + coord.y].push(Math.pow(coord.diff, 2));\n            });\n        });\n        let keys = Object.keys(distances);\n        keys.forEach((key) => {\n            knn.push({\n                x_y: key,\n                distance: Math.sqrt(distances[key].reduce((a, b) => { return a+b; }))\n            });\n        });\n        knn.sort((a, b) => { return a.distance > b.distance; });\n\n        console.log(knn);\n    }\n\n}\n\nnew Test();"]}